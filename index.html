<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Time Sense</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment/moment.js"></script>
    <script>
      const dataset = [];
    </script>
    <style>
      * {
        margin: 0;
        padding: 0;
      }

      html, body {
        height: 100%;
      }

      body {
        overflow-x: hidden;
      }

      #debug {
        display: none;
      }

      #app {
        text-align: center;
        width: 100%;
        height: 100%;
        padding: 2em;
        box-sizing: border-box;
      }

      #app svg {
        height: 100%;
      }

      #app #clock {
        font: serif;
        font-size: 0.1px;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <svg viewBox="-1 -1 2 2">
        <g id="debug">
          <circle cx="-1.0" cy="-1.0" r="0.02" fill="black" />
          <circle cx="-0.5" cy="-1.0" r="0.02" fill="black" />
          <circle cx="0.0"  cy="-1.0" r="0.02" fill="black" />
          <circle cx="0.5"  cy="-1.0" r="0.02" fill="black" />
          <circle cx="1.0"  cy="-1.0" r="0.02" fill="black" />

          <circle cx="-1.0" cy="-0.5" r="0.02" fill="black" />
          <circle cx="-0.5" cy="-0.5" r="0.02" fill="black" />
          <circle cx="0.0"  cy="-0.5" r="0.02" fill="black" />
          <circle cx="0.5"  cy="-0.5" r="0.02" fill="black" />
          <circle cx="1.0"  cy="-0.5" r="0.02" fill="black" />

          <circle cx="-1.0" cy="0.0"  r="0.02" fill="black" />
          <circle cx="-0.5" cy="0.0"  r="0.02" fill="black" />
          <circle cx="0.0"  cy="0.0"  r="0.02" fill="red" />
          <circle cx="0.5"  cy="0.0"  r="0.02" fill="black" />
          <circle cx="1.0"  cy="0.0"  r="0.02" fill="black" />

          <circle cx="-1.0" cy="0.5"  r="0.02" fill="black" />
          <circle cx="-0.5" cy="0.5"  r="0.02" fill="black" />
          <circle cx="0.0"  cy="0.5"  r="0.02" fill="black" />
          <circle cx="0.5"  cy="0.5"  r="0.02" fill="black" />
          <circle cx="1.0"  cy="0.5"  r="0.02" fill="black" />

          <circle cx="-1.0" cy="1.0"  r="0.02" fill="black" />
          <circle cx="-0.5" cy="1.0"  r="0.02" fill="black" />
          <circle cx="0.0"  cy="1.0"  r="0.02" fill="black" />
          <circle cx="0.5"  cy="1.0"  r="0.02" fill="black" />
          <circle cx="1.0"  cy="1.0"  r="0.02" fill="black" />
        </g>

        <clock id="clock"/>
        <manager id="manager"/>
      </svg>
    </div>
    <script>
      Vue.component('clock', {
        data: function() {
          return {
            now: '',
          }
        },
        mounted: function() {
          requestAnimationFrame(this.tick);
        },
        methods: {
          tick: function() {
            this.now = moment();
            requestAnimationFrame(this.tick);
          },
        },
        template: `
          <text x="0" y="0" text-anchor="middle">{{ now }}</text>
        `,
      });

      Vue.component('manager', {
        data: function() {
          return {
            arcs: [
              { value: 0, r1: 0.1, r2: 0.15},
              { value: 0, r1: 0.2, r2: 0.3},
              { value: 0, r1: 0.4, r2: 0.55},
              { value: 0, r1: 0.7, r2: 0.9},
            ],
          };
        },
        mounted: function() {
          requestAnimationFrame(this.tick);
        },
        methods: {
          tick: function() {
            const now = moment();

            this.arcs[0].value = ((now.valueOf() / 1000) % 2) / 2;
            this.arcs[1].value = ((now.valueOf() / 1000) % 3) / 3;
            this.arcs[2].value = ((now.valueOf() / 1000) % 5) / 5;
            this.arcs[3].value = ((now.valueOf() / 1000) % 7) / 7;

            requestAnimationFrame(this.tick);
          }
        },
        template: `
          <g>
            <arc
              v-for="(arc, i) in arcs"
              v-bind:key="i"
              v-bind:value="arc.value"
              v-bind:r1="arc.r1"
              v-bind:r2="arc.r2"/>
          </g>
        `,
      });

      Vue.component('arc', {
        props: [
          'value',
          'r1',
          'r2',
        ],
        computed: {
          d: function() {
            const t1 = 0;
            const t2 = 2 * Math.PI * this.value;
            const large_arc_flag = this.value > 0.5 ? 1 : 0;
            const x_i1 =  this.r1 * Math.sin(t1);
            const y_i1 = -this.r1 * Math.cos(t1);
            const x_i2 =  this.r1 * Math.sin(t2);
            const y_i2 = -this.r1 * Math.cos(t2);
            const x_o2 =  this.r2 * Math.sin(t2);
            const y_o2 = -this.r2 * Math.cos(t2);
            const x_o1 =  this.r2 * Math.sin(t1);
            const y_o1 = -this.r2 * Math.cos(t1);
            return `M ${x_i1} ${y_i1}
                    A ${this.r1} ${this.r1} 0 ${large_arc_flag} 1 ${x_i2} ${y_i2}
                    L ${x_o2} ${y_o2}
                    A ${this.r2} ${this.r2} 0 ${large_arc_flag} 0 ${x_o1} ${y_o1}
                    L ${x_i1} ${y_i1}`;
          },
        },
        template: `
          <path
            v-bind:d="d"
            fill="tomato"
            fill-opacity="0.5"
            />
        `,
      });

      const app = new Vue({ el: '#app' });
    </script>
  </body>
</html>
